/************************************************
 * Author: Michael Meindl
 * Datum : 17.04.2016
 ***********************************************/
#ifndef CCONTROLACTIONHANDLER_H
#define CCONTROLACTIONHANDLER_H
#include "Global.h"
#include "SSoftTimer.h"
#include "CSTMHardware.h"
#include "CSimulatedHardware.h"
#include "CLQR.h"
#include "CComplementaryFilter.h"
#include "TKalmanFilter.h"
#include "CSensorEvaluation.h"

class CControlActionHandler
{
public:
	void onEntryConfiguration();
	void onExitConfiguration();
	void onEntryRunning();
	void onExitRunning();
	void onEntryIdle();
	void onExitIdle();
	void onEntryBalance();
	void onExitBalance();
	void onEntryJump();
	void onExitJump();
	void onEntryWaiting();
	void onExitWaiting();
	void onEntryAccelerate();
	void onExitAccelerate();
	void onEntryBrake();
	void onExitBrake();
	//Helper methods
	bool phiK_inBalanceArea();
	bool cubeIsResting();
	bool jumpVelocityReached();
	bool breakingFinished();
	void controlIteration();
	void getLogData();
	bool getJumpFlag();
	bool getBalanceFlag();
	bool getTransmitFlag();
	void setJumpFlag(UInt8 jumpFlag);
	void setBalanceFlag(UInt8 balanceFlag);
	void setTransmitFlag(UInt8 transmitFlag);
public:
	CControlActionHandler();
	CControlActionHandler(const CControlActionHandler&) = delete;
	CControlActionHandler& operator=(const CControlActionHandler&) = delete;
	~CControlActionHandler() = default;
private:
	bool mJumpFlag;
	bool mBalanceFlag;
	bool mTransmitFlag;
	float mPhiK;
	float mPhiK_d;
	float mPhiR_d;
	SSoftTimer& mSoftTimer;
	CSTMHardware mHardware;
	CSensorEvaluation mSensorEval;
	CComplementaryFilter mComp;
	TKalmanFilter<7U> mKalman;
	CLQR mLQR;
};

#endif
