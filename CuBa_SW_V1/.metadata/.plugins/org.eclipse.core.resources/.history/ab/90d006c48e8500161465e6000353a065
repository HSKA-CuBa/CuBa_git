/**
 * @file	CCommComponent.cpp
 * @author	Michael Meindl
 * @date	28.9.2016
 * @brief	Method definitions for CCommComponent.
 */
#include "CCommComponent.h"
#include <iostream>

CCommComponent::CCommComponent() : mConnectedFlag(false),
								   mServer(),
								   mReceiveTask(mServer),
								   mReceiveThread(&mReceiveTask)
{

}
void CCommComponent::init()
{
	std::cout << "[CommComponent] Initializing" << std::endl;
	mServer.init();
	mReceiveThread.start();
}
void CCommComponent::run()
{
	CMessage rxMsg;
	while(true)
	{
		if(false == mConnectedFlag)
		{
			mServer.waitForClient();
			mConnectedFlag = true;
			mReceiveTask.resume(true);
		}
		else
		{
			if(mQueue.popFront(msg, true))
			{
				if(mServer.transmitMessage(msg) == false)
				{
					mConnectedFlag = false;
				}
			}
		}
	}
}
